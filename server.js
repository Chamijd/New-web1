const _0x228dd4=_0x2ed0;(function(_0x24f57d,_0x1ee069){const _0x4a8bdb=_0x2ed0,_0x90f264=_0x24f57d();while(!![]){try{const _0x55c34e=parseInt(_0x4a8bdb(0x17e))/0x1*(parseInt(_0x4a8bdb(0x1a2))/0x2)+-parseInt(_0x4a8bdb(0x15c))/0x3+parseInt(_0x4a8bdb(0x195))/0x4+parseInt(_0x4a8bdb(0x16f))/0x5+parseInt(_0x4a8bdb(0x163))/0x6+parseInt(_0x4a8bdb(0x182))/0x7*(-parseInt(_0x4a8bdb(0x1a3))/0x8)+parseInt(_0x4a8bdb(0x199))/0x9*(parseInt(_0x4a8bdb(0x174))/0xa);if(_0x55c34e===_0x1ee069)break;else _0x90f264['push'](_0x90f264['shift']());}catch(_0x44a302){_0x90f264['push'](_0x90f264['shift']());}}}(_0x4a1e,0x4a067));const express=require('express'),mongoose=require('mongoose'),cors=require(_0x228dd4(0x15b)),path=require('path'),multer=require(_0x228dd4(0x186)),fs=require('fs'),app=express();app[_0x228dd4(0x17b)](cors()),app['use'](express[_0x228dd4(0x171)]()),app[_0x228dd4(0x17b)](express[_0x228dd4(0x1a0)](__dirname));const upload=multer({'dest':'uploads/','limits':{'fileSize':0x5*0x400*0x400},'fileFilter':(_0x50617f,_0x33d2fb,_0x4095bf)=>{const _0x538ca1=_0x228dd4;_0x33d2fb['mimetype'][_0x538ca1(0x189)](_0x538ca1(0x170))?_0x4095bf(null,!![]):_0x4095bf(new Error('Only\x20image\x20files\x20are\x20allowed!'),![]);}});mongoose[_0x228dd4(0x194)](_0x228dd4(0x164));const ReplySchema=new mongoose[(_0x228dd4(0x16a))]({'name':String,'comment':String,'date':{'type':Date,'default':Date[_0x228dd4(0x18b)]},'imageUrl':String,'reactions':{'like':{'type':Number,'default':0x0},'love':{'type':Number,'default':0x0},'laugh':{'type':Number,'default':0x0},'likeUsers':{'type':[String],'default':[]},'loveUsers':{'type':[String],'default':[]},'laughUsers':{'type':[String],'default':[]}}}),CommentSchema=new mongoose['Schema']({'name':String,'comment':String,'date':{'type':Date,'default':Date['now']},'imageUrl':String,'replies':[ReplySchema],'reactions':{'like':{'type':Number,'default':0x0},'love':{'type':Number,'default':0x0},'laugh':{'type':Number,'default':0x0},'likeUsers':{'type':[String],'default':[]},'loveUsers':{'type':[String],'default':[]},'laughUsers':{'type':[String],'default':[]}}}),Comment=mongoose[_0x228dd4(0x185)](_0x228dd4(0x15f),CommentSchema);!fs['existsSync'](_0x228dd4(0x190))&&fs[_0x228dd4(0x19a)](_0x228dd4(0x190));function _0x4a1e(){const _0x29e05d=['love','Schema','Comment\x20not\x20found','stack','remove','image','1379300lRiUGU','image/','json','message','Users','292160rGEAXy','post','chamindu1981','join','find','like','Comment\x20deleted\x20successfully','use','Internal\x20server\x20error','commentId','277WcoXLB','includes','laugh','save','1327550dYcAzh','/comments/react','originalname','model','multer','env','single','startsWith','PORT','now','loveUsers','params','Incorrect\x20password','replyId','uploads','/uploads','unlinkSync','Reply\x20deleted\x20successfully','connect','900176vmeIko','file','findById','replies','27WqWFrL','mkdirSync','uploads/','delete','Failed\x20to\x20load\x20comments','filter','/comments','static','push','8wIZbsD','16MxEjrn','reactions','path','/comments/:id','error','renameSync','findByIdAndDelete','Reply\x20not\x20found','cors','773085iIenhW','imageUrl','log','Comment','/comments/reply','get','likeUsers','2103252hfBxdR','mongodb+srv://jikew32666:nih7jgcq1pkSSyGY@cluster0.jbdxjkc.mongodb.net/autoreplydb','Missing\x20required\x20fields','Name\x20and\x20comment\x20are\x20required','status','body'];_0x4a1e=function(){return _0x29e05d;};return _0x4a1e();}const DELETE_PASSWORD=_0x228dd4(0x176);function _0x2ed0(_0x4d6a78,_0xa5ed41){const _0x4a1e30=_0x4a1e();return _0x2ed0=function(_0x2ed095,_0x4becbf){_0x2ed095=_0x2ed095-0x155;let _0x1d38ca=_0x4a1e30[_0x2ed095];return _0x1d38ca;},_0x2ed0(_0x4d6a78,_0xa5ed41);}app[_0x228dd4(0x161)](_0x228dd4(0x19f),async(_0x2041fe,_0xe07810)=>{const _0x501f9e=_0x228dd4;try{const _0x2c4e95=await Comment[_0x501f9e(0x178)]()['sort']({'date':-0x1});_0xe07810[_0x501f9e(0x171)](_0x2c4e95);}catch(_0x209e84){_0xe07810['status'](0x1f4)['json']({'error':_0x501f9e(0x19d)});}}),app['post'](_0x228dd4(0x19f),upload[_0x228dd4(0x188)](_0x228dd4(0x16e)),async(_0x584bb4,_0x2cc430)=>{const _0x585231=_0x228dd4;try{const {name:_0x521d5b,comment:_0xb2e9a}=_0x584bb4[_0x585231(0x168)];if(!_0x521d5b||!_0xb2e9a)return _0x2cc430[_0x585231(0x167)](0x190)[_0x585231(0x171)]({'error':_0x585231(0x166)});let _0x4bda59='';if(_0x584bb4['file']){const _0x52b0b3=_0x585231(0x19b)+Date[_0x585231(0x18b)]()+'_'+_0x584bb4[_0x585231(0x196)][_0x585231(0x184)];fs[_0x585231(0x158)](_0x584bb4[_0x585231(0x196)][_0x585231(0x155)],_0x52b0b3),_0x4bda59='/'+_0x52b0b3;}const _0x110c4d=new Comment({'name':_0x521d5b,'comment':_0xb2e9a,'imageUrl':_0x4bda59});await _0x110c4d[_0x585231(0x181)](),_0x2cc430[_0x585231(0x167)](0xc9)[_0x585231(0x171)](_0x110c4d);}catch(_0x29c78b){_0x2cc430[_0x585231(0x167)](0x1f4)[_0x585231(0x171)]({'error':_0x29c78b['message']});}}),app[_0x228dd4(0x175)](_0x228dd4(0x160),upload[_0x228dd4(0x188)](_0x228dd4(0x16e)),async(_0x4bf99b,_0x5751b3)=>{const _0x3bfb89=_0x228dd4;try{const {parentId:_0x28d32c,name:_0x560fa0,comment:_0x53c795}=_0x4bf99b[_0x3bfb89(0x168)];if(!_0x28d32c||!_0x560fa0||!_0x53c795)return _0x5751b3['status'](0x190)[_0x3bfb89(0x171)]({'error':_0x3bfb89(0x165)});const _0x2fa10e=await Comment[_0x3bfb89(0x197)](_0x28d32c);if(!_0x2fa10e)return _0x5751b3[_0x3bfb89(0x167)](0x194)[_0x3bfb89(0x171)]({'error':_0x3bfb89(0x16b)});let _0x2ee31f='';if(_0x4bf99b[_0x3bfb89(0x196)]){const _0x1b9a32=_0x3bfb89(0x19b)+Date[_0x3bfb89(0x18b)]()+'_'+_0x4bf99b[_0x3bfb89(0x196)]['originalname'];fs[_0x3bfb89(0x158)](_0x4bf99b['file'][_0x3bfb89(0x155)],_0x1b9a32),_0x2ee31f='/'+_0x1b9a32;}_0x2fa10e['replies'][_0x3bfb89(0x1a1)]({'name':_0x560fa0,'comment':_0x53c795,'imageUrl':_0x2ee31f}),await _0x2fa10e[_0x3bfb89(0x181)](),_0x5751b3[_0x3bfb89(0x167)](0xc9)['json'](_0x2fa10e);}catch(_0x478230){_0x5751b3['status'](0x1f4)[_0x3bfb89(0x171)]({'error':_0x478230[_0x3bfb89(0x172)]});}}),app[_0x228dd4(0x175)](_0x228dd4(0x183),async(_0x8f24f4,_0x27dcc6)=>{const _0xe0d80a=_0x228dd4;try{const {commentId:_0x247440,replyId:_0x5e0baa,type:_0x22b49f,userIP:_0x9ea1f9}=_0x8f24f4['body'],_0x1f43db=[_0xe0d80a(0x179),_0xe0d80a(0x169),_0xe0d80a(0x180)];if(!_0x1f43db[_0xe0d80a(0x17f)](_0x22b49f))return _0x27dcc6['status'](0x190)['json']({'error':'Invalid\x20reaction\x20type'});const _0x2a6bac=await Comment[_0xe0d80a(0x197)](_0x247440);if(!_0x2a6bac)return _0x27dcc6['status'](0x194)[_0xe0d80a(0x171)]({'error':_0xe0d80a(0x16b)});if(_0x5e0baa){const _0x1940e6=_0x2a6bac[_0xe0d80a(0x198)]['id'](_0x5e0baa);if(!_0x1940e6)return _0x27dcc6[_0xe0d80a(0x167)](0x194)[_0xe0d80a(0x171)]({'error':_0xe0d80a(0x15a)});!_0x1940e6[_0xe0d80a(0x1a4)]&&(_0x1940e6[_0xe0d80a(0x1a4)]={'like':0x0,'love':0x0,'laugh':0x0,'likeUsers':[],'loveUsers':[],'laughUsers':[]});const _0x108ffd=[..._0x1940e6[_0xe0d80a(0x1a4)][_0xe0d80a(0x162)],..._0x1940e6[_0xe0d80a(0x1a4)]['loveUsers'],..._0x1940e6[_0xe0d80a(0x1a4)]['laughUsers']];if(_0x108ffd[_0xe0d80a(0x17f)](_0x9ea1f9)){const _0x51f1ce=_0x1940e6[_0xe0d80a(0x1a4)][_0xe0d80a(0x162)][_0xe0d80a(0x17f)](_0x9ea1f9)?'like':_0x1940e6[_0xe0d80a(0x1a4)]['loveUsers']['includes'](_0x9ea1f9)?_0xe0d80a(0x169):_0xe0d80a(0x180);_0x51f1ce===_0x22b49f?(_0x1940e6[_0xe0d80a(0x1a4)][_0x22b49f]--,_0x1940e6[_0xe0d80a(0x1a4)][_0x22b49f+_0xe0d80a(0x173)]=_0x1940e6[_0xe0d80a(0x1a4)][_0x22b49f+_0xe0d80a(0x173)][_0xe0d80a(0x19e)](_0xc9f4ea=>_0xc9f4ea!==_0x9ea1f9)):(_0x1940e6[_0xe0d80a(0x1a4)][_0x51f1ce]--,_0x1940e6['reactions'][_0x51f1ce+_0xe0d80a(0x173)]=_0x1940e6[_0xe0d80a(0x1a4)][_0x51f1ce+_0xe0d80a(0x173)][_0xe0d80a(0x19e)](_0xf681ae=>_0xf681ae!==_0x9ea1f9),_0x1940e6['reactions'][_0x22b49f]++,_0x1940e6['reactions'][_0x22b49f+_0xe0d80a(0x173)]['push'](_0x9ea1f9));}else _0x1940e6['reactions'][_0x22b49f]++,_0x1940e6[_0xe0d80a(0x1a4)][_0x22b49f+'Users'][_0xe0d80a(0x1a1)](_0x9ea1f9);}else{!_0x2a6bac[_0xe0d80a(0x1a4)]&&(_0x2a6bac[_0xe0d80a(0x1a4)]={'like':0x0,'love':0x0,'laugh':0x0,'likeUsers':[],'loveUsers':[],'laughUsers':[]});const _0x4bea02=[..._0x2a6bac[_0xe0d80a(0x1a4)]['likeUsers'],..._0x2a6bac[_0xe0d80a(0x1a4)]['loveUsers'],..._0x2a6bac[_0xe0d80a(0x1a4)]['laughUsers']];if(_0x4bea02[_0xe0d80a(0x17f)](_0x9ea1f9)){const _0x69eb69=_0x2a6bac[_0xe0d80a(0x1a4)]['likeUsers'][_0xe0d80a(0x17f)](_0x9ea1f9)?_0xe0d80a(0x179):_0x2a6bac['reactions'][_0xe0d80a(0x18c)][_0xe0d80a(0x17f)](_0x9ea1f9)?'love':_0xe0d80a(0x180);_0x69eb69===_0x22b49f?(_0x2a6bac[_0xe0d80a(0x1a4)][_0x22b49f]--,_0x2a6bac['reactions'][_0x22b49f+_0xe0d80a(0x173)]=_0x2a6bac[_0xe0d80a(0x1a4)][_0x22b49f+'Users'][_0xe0d80a(0x19e)](_0x4cf411=>_0x4cf411!==_0x9ea1f9)):(_0x2a6bac[_0xe0d80a(0x1a4)][_0x69eb69]--,_0x2a6bac['reactions'][_0x69eb69+_0xe0d80a(0x173)]=_0x2a6bac[_0xe0d80a(0x1a4)][_0x69eb69+_0xe0d80a(0x173)][_0xe0d80a(0x19e)](_0x259ac0=>_0x259ac0!==_0x9ea1f9),_0x2a6bac[_0xe0d80a(0x1a4)][_0x22b49f]++,_0x2a6bac['reactions'][_0x22b49f+_0xe0d80a(0x173)][_0xe0d80a(0x1a1)](_0x9ea1f9));}else _0x2a6bac[_0xe0d80a(0x1a4)][_0x22b49f]++,_0x2a6bac[_0xe0d80a(0x1a4)][_0x22b49f+_0xe0d80a(0x173)]['push'](_0x9ea1f9);}await _0x2a6bac[_0xe0d80a(0x181)](),_0x27dcc6[_0xe0d80a(0x167)](0xc8)[_0xe0d80a(0x171)](_0x2a6bac);}catch(_0x31a952){console[_0xe0d80a(0x157)](_0x31a952),_0x27dcc6[_0xe0d80a(0x167)](0x1f4)['json']({'error':_0xe0d80a(0x17c)});}}),app[_0x228dd4(0x19c)](_0x228dd4(0x156),async(_0x1013c8,_0x59c709)=>{const _0x3f4722=_0x228dd4;try{const {password:_0x2f187a}=_0x1013c8['body'];if(_0x2f187a!==DELETE_PASSWORD)return _0x59c709[_0x3f4722(0x167)](0x193)[_0x3f4722(0x171)]({'error':_0x3f4722(0x18e)});const _0x386c87=await Comment[_0x3f4722(0x159)](_0x1013c8[_0x3f4722(0x18d)]['id']);if(!_0x386c87)return _0x59c709[_0x3f4722(0x167)](0x194)[_0x3f4722(0x171)]({'error':_0x3f4722(0x16b)});if(_0x386c87[_0x3f4722(0x15d)]){const _0x2044af=path[_0x3f4722(0x177)](__dirname,_0x386c87['imageUrl']);fs['existsSync'](_0x2044af)&&fs[_0x3f4722(0x192)](_0x2044af);}_0x59c709[_0x3f4722(0x167)](0xc8)['json']({'message':_0x3f4722(0x17a)});}catch(_0xe6b284){console['error'](_0xe6b284),_0x59c709[_0x3f4722(0x167)](0x1f4)[_0x3f4722(0x171)]({'error':_0x3f4722(0x17c)});}}),app[_0x228dd4(0x19c)]('/comments/:commentId/replies/:replyId',async(_0x3ea4f2,_0x4c2c9f)=>{const _0xf3014e=_0x228dd4;try{const {password:_0x2a0674}=_0x3ea4f2[_0xf3014e(0x168)];if(_0x2a0674!==DELETE_PASSWORD)return _0x4c2c9f[_0xf3014e(0x167)](0x193)['json']({'error':_0xf3014e(0x18e)});const _0x23c07d=await Comment[_0xf3014e(0x197)](_0x3ea4f2[_0xf3014e(0x18d)][_0xf3014e(0x17d)]);if(!_0x23c07d)return _0x4c2c9f[_0xf3014e(0x167)](0x194)[_0xf3014e(0x171)]({'error':_0xf3014e(0x16b)});const _0x3dc75a=_0x23c07d[_0xf3014e(0x198)]['id'](_0x3ea4f2['params'][_0xf3014e(0x18f)]);if(!_0x3dc75a)return _0x4c2c9f[_0xf3014e(0x167)](0x194)['json']({'error':'Reply\x20not\x20found'});if(_0x3dc75a[_0xf3014e(0x15d)]){const _0x11ba59=path[_0xf3014e(0x177)](__dirname,_0x3dc75a[_0xf3014e(0x15d)]);fs['existsSync'](_0x11ba59)&&fs[_0xf3014e(0x192)](_0x11ba59);}_0x3dc75a[_0xf3014e(0x16d)](),await _0x23c07d[_0xf3014e(0x181)](),_0x4c2c9f['status'](0xc8)[_0xf3014e(0x171)]({'message':_0xf3014e(0x193)});}catch(_0x3386c0){console['error'](_0x3386c0),_0x4c2c9f[_0xf3014e(0x167)](0x1f4)[_0xf3014e(0x171)]({'error':_0xf3014e(0x17c)});}}),app[_0x228dd4(0x17b)](_0x228dd4(0x191),express[_0x228dd4(0x1a0)]('uploads')),app[_0x228dd4(0x17b)]((_0xec942c,_0x49e9e3,_0x35a786,_0xec9f4b)=>{const _0x5a16b7=_0x228dd4;console['error'](_0xec942c[_0x5a16b7(0x16c)]),_0x35a786[_0x5a16b7(0x167)](0x1f4)[_0x5a16b7(0x171)]({'error':_0xec942c[_0x5a16b7(0x172)]});});const PORT=process[_0x228dd4(0x187)][_0x228dd4(0x18a)]||0xbb8;app['listen'](PORT,()=>console[_0x228dd4(0x15e)]('Server\x20running\x20on\x20port\x20'+PORT));
