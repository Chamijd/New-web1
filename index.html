<!doctype html>
<html>
<head>
<title>CHAMA MD WEB NEW</title>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<style>:root{--bg-dark:#000428;--bg-light:#ffffff;--text-dark:#ffffff;--text-light:#000000;--highlight:#ffdd57;--danger:#ff3860}body{background:var(--bg-dark);color:var(--text-dark);font-family:sans-serif;padding:30px;text-align:center;transition:all .3s ease}body.light{background:var(--bg-light);color:var(--text-light)}input,textarea{width:80%;padding:10px;margin:10px 0;border-radius:10px;border:none;outline:0;font-size:16px}button{background:linear-gradient(to right,#9b00ff,#ff0076);color:#fff;padding:12px 24px;border:none;border-radius:12px;font-weight:700;cursor:pointer;font-size:16px;margin:5px}.comment{background-color:rgba(255,255,255,.1);padding:15px;border-radius:12px;margin:10px auto;max-width:600px;text-align:left;box-shadow:0 0 10px rgba(255,255,255,.2);position:relative}.comment strong{color:var(--highlight);font-size:18px}.comment small{color:#ccc;font-size:12px}#comments{margin-top:30px}.reply{margin-top:10px;padding-left:20px;font-size:14px;color:#f1f1f1;border-left:2px solid var(--highlight)}.reply small{font-size:11px;color:#ccc}.theme-toggle{position:absolute;top:10px;right:10px;cursor:pointer}.actions{display:flex;align-items:center;margin-top:10px}.reply-btn{background:0 0;border:1px solid var(--highlight);padding:5px 10px;font-size:12px;color:var(--highlight)}.delete-btn{background:0 0;border:1px solid var(--danger);padding:5px 10px;font-size:12px;color:var(--danger);margin-left:10px}.reactions{display:flex;margin-left:10px}.reaction{background:rgba(255,255,255,.1);border-radius:50%;width:30px;height:30px;display:flex;align-items:center;justify-content:center;margin-right:5px;cursor:pointer;transition:all .2s;position:relative}.reaction:hover{transform:scale(1.2)}.reaction.active{background:var(--highlight);color:#000}.reaction-count{font-size:10px;margin-left:3px}.reply-form{margin-top:10px;display:none}.reply-form.active{display:block}.user-reacted{position:absolute;bottom:-5px;right:-5px;font-size:8px;background:var(--highlight);color:#000;border-radius:50%;width:12px;height:12px;display:flex;align-items:center;justify-content:center}.comment-image{max-width:100%;max-height:300px;border-radius:8px;margin-top:10px;cursor:pointer;transition:transform .3s}.comment-image:hover{transform:scale(1.02)}.image-preview{max-width:100px;max-height:100px;margin-right:10px;border-radius:5px;display:none}.file-upload{display:flex;align-items:center;margin:10px 0}.file-upload-label{background:rgba(255,255,255,.1);padding:8px 15px;border-radius:8px;cursor:pointer;display:inline-block}#image-upload{display:none}.modal{display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.9);align-items:center;justify-content:center}.modal-image{max-width:90%;max-height:90%}.close-modal{position:absolute;top:20px;right:30px;color:#fff;font-size:30px;cursor:pointer}.password-modal{display:none;position:fixed;z-index:100;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);align-items:center;justify-content:center}.password-modal-content{background:var(--bg-dark);padding:20px;border-radius:10px;width:300px;text-align:center}.password-modal input{width:100%;margin:10px 0}.password-modal button{width:100%}.error-message{color:var(--danger);font-size:14px;margin-top:5px;display:none}</style>
</head>
<body>
<button class=theme-toggle onclick=toggleTheme()>üåì</button>
<h2>üí¨ Leave a Comment</h2>
<input id=name placeholder="Your Name"><br>
<textarea id=comment placeholder="Your Comment üòä"></textarea><br>
<div class=file-upload>
<label for=image-upload class=file-upload-label>üì∑</label>
<input type=file id=image-upload accept=image/*>
<img id=image-preview class=image-preview>
</div>
<button onclick=submitComment()>Post Comment</button>
<div id=comments></div>
<div class=modal id=image-modal>
<span class=close-modal onclick=closeModal()>&times;</span>
<img class=modal-image id=modal-image>
</div>
<div class=password-modal id=password-modal>
<div class=password-modal-content>
<h3>Enter Password</h3>
<input type=password id=delete-password placeholder=Password>
<div class=error-message id=password-error>Incorrect password!</div>
<button onclick=confirmDelete()>Confirm</button>
<button onclick=closePasswordModal() style=background:#666;margin-top:10px>Cancel</button>
</div>
</div>
<script>let userIP="",selectedImage=null,currentDeleteAction=null;function toggleTheme(){document.body.classList.toggle("light")}function submitComment(){const e=document.getElementById("name").value.trim(),n=document.getElementById("comment").value.trim();if(!e||!n)return alert("Name and comment are required!");const t=new FormData;t.append("name",e),t.append("comment",n),selectedImage&&t.append("image",selectedImage),fetch("/comments",{method:"POST",body:t}).then((e=>{e.ok&&(document.getElementById("name").value="",document.getElementById("comment").value="",document.getElementById("image-upload").value="",document.getElementById("image-preview").style.display="none",selectedImage=null,loadComments())}))}function loadComments(){fetch("/comments").then((e=>e.json())).then((e=>{document.getElementById("comments").innerHTML=e.map((e=>`\n            <div class="comment" data-id="${e._id}">\n              <strong>${e.name}</strong><br/>\n              <span>${e.comment}</span><br/>\n              ${e.imageUrl?`<img src="${e.imageUrl}" class="comment-image" onclick="openModal('${e.imageUrl}')"/>`:""}\n              <small>${new Date(e.date).toLocaleString()}</small>\n              \n              <div class="actions">\n                <button class="reply-btn" onclick="toggleReplyForm('${e._id}')">Reply</button>\n                <button class="delete-btn" onclick="showPasswordModal('comment', '${e._id}')">Delete</button>\n                <div class="reactions">\n                  <div class="reaction ${e.reactions?.likeUsers?.includes(userIP)?"active":""}" \n                       onclick="addReaction('${e._id}', null, 'like')">\n                    üëç<span class="reaction-count">${e.reactions?.like||0}</span>\n                    ${e.reactions?.likeUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                  </div>\n                  <div class="reaction ${e.reactions?.loveUsers?.includes(userIP)?"active":""}" \n                       onclick="addReaction('${e._id}', null, 'love')">\n                    ‚ù§Ô∏è<span class="reaction-count">${e.reactions?.love||0}</span>\n                    ${e.reactions?.loveUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                  </div>\n                  <div class="reaction ${e.reactions?.laughUsers?.includes(userIP)?"active":""}" \n                       onclick="addReaction('${e._id}', null, 'laugh')">\n                    üòÇ<span class="reaction-count">${e.reactions?.laugh||0}</span>\n                    ${e.reactions?.laughUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                  </div>\n                </div>\n              </div>\n              \n              <div class="reply-form" id="reply-form-${e._id}">\n                <input type="text" id="reply-name-${e._id}" placeholder="Your Name"/>\n                <textarea id="reply-comment-${e._id}" placeholder="Your Reply"></textarea>\n                <div class="file-upload">\n                  <label for="reply-image-${e._id}" class="file-upload-label">üì∑</label>\n                  <input type="file" id="reply-image-${e._id}" class="reply-image-upload" accept="image/*"/>\n                  <img id="reply-image-preview-${e._id}" class="image-preview"/>\n                </div>\n                <button onclick="submitReply('${e._id}')">Post Reply</button>\n              </div>\n              \n              <div id="replies-${e._id}">\n                ${e.replies?.map((n=>`\n                  <div class="reply" data-id="${n._id}" data-parent="${e._id}">\n                    <strong>${n.name}</strong>: ${n.comment}<br/>\n                    ${n.imageUrl?`<img src="${n.imageUrl}" class="comment-image" onclick="openModal('${n.imageUrl}')"/>`:""}\n                    <small>${new Date(n.date).toLocaleString()}</small>\n                    <div class="actions">\n                      <button class="delete-btn" onclick="showPasswordModal('reply', '${e._id}', '${n._id}')">Delete</button>\n                      <div class="reactions">\n                        <div class="reaction ${n.reactions?.likeUsers?.includes(userIP)?"active":""}" \n                             onclick="addReaction('${e._id}', '${n._id}', 'like')">\n                          üëç<span class="reaction-count">${n.reactions?.like||0}</span>\n                          ${n.reactions?.likeUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                        </div>\n                        <div class="reaction ${n.reactions?.loveUsers?.includes(userIP)?"active":""}" \n                             onclick="addReaction('${e._id}', '${n._id}', 'love')">\n                          ‚ù§Ô∏è<span class="reaction-count">${n.reactions?.love||0}</span>\n                          ${n.reactions?.loveUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                        </div>\n                        <div class="reaction ${n.reactions?.laughUsers?.includes(userIP)?"active":""}" \n                             onclick="addReaction('${e._id}', '${n._id}', 'laugh')">\n                          üòÇ<span class="reaction-count">${n.reactions?.laugh||0}</span>\n                          ${n.reactions?.laughUsers?.includes(userIP)?'<span class="user-reacted">‚úì</span>':""}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                `)).join("")||""}\n              </div>\n            </div>\n          `)).join(""),e.forEach((e=>{const n=`reply-image-${e._id}`,t=`reply-image-preview-${e._id}`;document.getElementById(n)?.addEventListener("change",(function(e){const n=e.target.files[0];if(n){const e=new FileReader;e.onload=function(e){const n=document.getElementById(t);n.src=e.target.result,n.style.display="block"},e.readAsDataURL(n)}}))}))}))}function toggleReplyForm(e){document.getElementById(`reply-form-${e}`).classList.toggle("active")}function submitReply(e){const n=document.getElementById(`reply-name-${e}`).value.trim(),t=document.getElementById(`reply-comment-${e}`).value.trim();if(!n||!t)return alert("Name and reply are required!");const a=document.getElementById(`reply-image-${e}`),s=new FormData;s.append("parentId",e),s.append("name",n),s.append("comment",t),a.files[0]&&s.append("image",a.files[0]),fetch("/comments/reply",{method:"POST",body:s}).then((n=>{n.ok&&(document.getElementById(`reply-name-${e}`).value="",document.getElementById(`reply-comment-${e}`).value="",document.getElementById(`reply-image-${e}`).value="",document.getElementById(`reply-image-preview-${e}`).style.display="none",document.getElementById(`reply-form-${e}`).classList.remove("active"),loadComments())}))}function addReaction(e,n,t){fetch("/comments/react",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({commentId:e,replyId:n,type:t,userIP:userIP})}).then((e=>{e.ok&&loadComments()}))}function openModal(e){const n=document.getElementById("image-modal"),t=document.getElementById("modal-image");n.style.display="flex",t.src=e}function closeModal(){document.getElementById("image-modal").style.display="none"}function showPasswordModal(e,n,t=null){currentDeleteAction={type:e,commentId:n,replyId:t},document.getElementById("password-modal").style.display="flex",document.getElementById("delete-password").value="",document.getElementById("password-error").style.display="none"}function closePasswordModal(){document.getElementById("password-modal").style.display="none",currentDeleteAction=null}function confirmDelete(){const e=document.getElementById("delete-password").value,n=document.getElementById("password-error");if(!currentDeleteAction)return n.textContent="No delete action specified",void(n.style.display="block");const{type:t,commentId:a,replyId:s}=currentDeleteAction;let l;if("comment"===t)l=`/comments/${a}`;else{if("reply"!==t)return n.textContent="Invalid delete type",void(n.style.display="block");l=`/comments/${a}/replies/${s}`}fetch(l,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}).then((e=>e.ok?e.json():e.json().then((e=>{throw new Error(e.error||"Failed to delete")})))).then((()=>{closePasswordModal(),loadComments()})).catch((e=>{n.textContent=e.message,n.style.display="block"}))}fetch("https://api.ipify.org?format=json").then((e=>e.json())).then((e=>{userIP=e.ip})).catch((()=>{userIP="local-"+Math.random().toString(36).substr(2,9)})),document.getElementById("image-upload").addEventListener("change",(function(e){const n=e.target.files[0];if(n){selectedImage=n;const e=new FileReader;e.onload=function(e){const n=document.getElementById("image-preview");n.src=e.target.result,n.style.display="block"},e.readAsDataURL(n)}})),window.onclick=function(e){const n=document.getElementById("image-modal");e.target==n&&closeModal();const t=document.getElementById("password-modal");e.target==t&&closePasswordModal()},loadComments()</script>
</body>
</html>
